function loadDataFile(n){var r,t,u,f;addHeader();var o=document.getElementById("mainDiv"),i=!1,e=scoreData.length-2;if(scoreHistory=[],n==="")for(t=0;t<e;t++)r="false",t>0&&t<scoreData.length-3&&(t===1&&(r="true"),scoreHistory.push({rowIndex:t.toString(),cellIndex:"",status:"false",isExpanded:r}));else i=!0;for(t=1;t<e;t++)u=addOuterDiv(t,i),f=addInnerDiv(t,i),f.appendChild(getScore(t,i)),u.appendChild(f),o.appendChild(u);if(i)try{scoreHistory=JSON.parse(n);loadHistory(scoreHistory)}catch(s){console.log(s)}return document.title.toLowerCase()==="score"&&addFooter(),!0}function addHeader(){scoreData[0].headerText!==""&&typeof scoreData[0].headerText!="undefined"&&document.title.toLowerCase()==="score"&&document.getElementsByTagName("body")[0].insertBefore(getHeader(),document.getElementById("mainDiv"))}function getHeader(){var t=document.createElement("div"),n;return t.setAttribute("id","headerDiv"),n=document.createElement("p"),n.setAttribute("class","text-left"),n.appendChild(document.createTextNode(scoreData[0].headerText)),t.appendChild(n),t}function getScore(n,t){var u=document.createElement("table"),i,r;for(u.setAttribute("class","table-block"),u.setAttribute("id",scoreData[n].boxId),i=[],n===0||(i=n===1?getRow(scoreData[n],n,Mode.FOCUS):n===scoreData.length-3?getResultRow():t?getRow(scoreData[n],n,Mode.FOCUS):getRow(scoreData[n],n,Mode.BLUR)),r=0;r<i.length;r++)u.appendChild(i[r]),$("#"+i[r].id).css("display","none").slideDownBox(Scroll.LENGTH_LONG);return u}function addOuterDiv(n,t){var i=document.createElement("div");return t?n===1?(i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_TOP_OUTER),i.setAttribute("id","box".concat(scoreData[n].boxId))):n===scoreData.length-3?(i.setAttribute("class",ScoreStyleClass.SCORE_RESULT_OUTER),i.setAttribute("id","scoreBox")):(i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_MIDDLE_OUTER),i.setAttribute("id","box".concat(scoreData[n].boxId))):n===1?(i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_TOP_OUTER),i.setAttribute("id","box".concat(scoreData[n].boxId))):n===scoreData.length-3?(i.setAttribute("class",ScoreStyleClass.SCORE_RESULT_OUTER),i.setAttribute("id","scoreBox")):(i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_BLUR),i.setAttribute("id","box".concat(scoreData[n].boxId))),i}function addInnerDiv(n,t){var i=document.createElement("div");return i.setAttribute("id","boxInner".concat(scoreData[n].boxId)),t?n===1?i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_TOP_INNER):n===scoreData.length-3?i.setAttribute("class",ScoreStyleClass.SCORE_RESULT_INNER):i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_MIDDLE_INNER):n===1?i.setAttribute("class",ScoreStyleClass.SCORE_BLOCK_TOP_INNER):n===scoreData.length-3&&i.setAttribute("class",ScoreStyleClass.SCORE_RESULT_INNER),i}function getRow(n,t,i){var u=[],r;for(u.push(getScoreRow(new ScoreCell(n.questionText,n.maxValue,t,0,i))),r=0;r<n.options.length;r++)u.push(getScoreRow(new ScoreCell(n.options[r].text,n.options[r].value,t,r+1,i)));return u}function getResultRow(){var e=getBoxInfo("997"),f=[],r=document.createElement("tr"),u=document.createElement("td"),n,t,i;return u.setAttribute("class","text-cell-blur"),n=document.createElement("p"),n.setAttribute("class","score-result-text"),n.innerHTML=document.createTextNode(e.scoreInfotext).data,u.appendChild(n),t=document.createElement("td"),t.setAttribute("class","value-cell-blur"),i=document.createElement("p"),i.setAttribute("class","score-text"),i.setAttribute("id","scoreSum"),t.appendChild(i),r.appendChild(u),r.appendChild(t),f.push(r),f}function ScoreCell(n,t,i,r,u){var f={};return f.text=n,f.value=t,f.parentIndex=i,f.childIndex=r,f.mode=u,f}function getScoreRow(n){var t=document.createElement("tr");t.setAttribute("id",getRowId(n.parentIndex,n.childIndex));var i=document.createElement("td"),r=document.createElement("p"),u=document.createElement("td"),f=document.createElement("p");return n.childIndex===0&&n.mode===Mode.FOCUS?(i.setAttribute("class","text-cell-top"),u.setAttribute("class","value-cell-top"),r.setAttribute("class",ScoreStyleClass.QUESTION_TEXT),f.setAttribute("class",ScoreStyleClass.MAX_VALUE)):n.childIndex>0&&n.mode===Mode.FOCUS?(i.setAttribute("class","text-cell-middle"),u.setAttribute("class","value-cell-middle"),r.setAttribute("class",ScoreStyleClass.OPTION_TEXT),f.setAttribute("class",ScoreStyleClass.OPTION_VALUE)):(n.childIndex>0&&(t.style.display="none"),i.setAttribute("class","text-cell-blur"),u.setAttribute("class","value-cell-blur"),r.setAttribute("class",ScoreStyleClass.TEXT_BLUR),f.setAttribute("class",ScoreStyleClass.VALUE_BLUR)),r.innerHTML=document.createTextNode(n.text).data,i.appendChild(r),f.innerHTML=document.createTextNode(n.value).data,u.appendChild(f),t.appendChild(i),t.appendChild(u),t}function showNextScoreBlock(n){var u=new ScoreTable(n),v=u.tableNodes.length,h=document.getElementById(u.tableNodeId),s,t,f,r,e,y,o,a;if(currentPosition=getTableBlockIndex(u.boxId),u.clickedRow>=0){var c=document.getElementById(h.parentNode.id),l=document.getElementById(h.parentNode.parentNode.id),i=[];for(s=1;s<v;s++)i.push(u.tableNodes[s]);if(t=scoreHistory[currentPosition],JSON.parse(t.status)){for(f=0;f<i.length;f++)$(i[f]).slideDownBox(),r=i[f].childNodes,r[0].classList[0]==="text-cell-select"&&(r[0].classList.remove("text-cell-select"),r[0].classList.add("text-cell-middle")),r[1].classList[0]==="value-cell-select"&&(r[1].classList.remove("value-cell-select"),r[1].classList.add("value-cell-middle"));t.status="false";t.cellIndex="";t.isExpanded="true";expandRow(l,c,currentPosition)}else{if(e=u.clickedRow,e>=0){for(y=0,o=0;o<i.length;o++)o!==e&&$("#"+i[o].id).slideUp("300");t.status="true";t.cellIndex=e.toString();t.isExpanded="false";a=i[e].childNodes;collapseRow(l,c,a)}currentPosition<getScoreLength()-2&&!JSON.parse(scoreHistory[currentPosition+1].status)&&openNextBlock(currentPosition+2)}console.log(JSON.stringify(scoreHistory));generateResult()}}function openNextBlock(n){var e=scoreHistory[n-1],u,f,r,i,t;for(e.isExpanded="true",console.log(scoreHistory[n-1]),u=document.getElementById("box".concat(n)),u.classList.remove("score-block-blur"),u.classList.add("score-block-middle-outer"),f=document.getElementById("boxInner".concat(n)),f.setAttribute("class","score-block-middle-inner"),r=document.getElementById(n).childNodes,i=0;i<r.length;i++)r[i].style.display="table-row",t=r[i].childNodes,i===0?(t[0].classList.remove("text-cell-blur"),t[0].classList.add("text-cell-top"),t[0].childNodes[0].classList.remove("text-blur"),t[0].childNodes[0].classList.add("question-text"),t[1].classList.remove("value-cell-blur"),t[1].classList.add("value-cell-top"),t[1].childNodes[0].classList.remove("value-blur"),t[1].childNodes[0].classList.add("max-value")):(t[0].classList.remove("text-cell-blur"),t[0].classList.add("text-cell-middle"),t[0].childNodes[0].classList.remove("text-blur"),t[0].childNodes[0].classList.add("option-text"),t[1].classList.remove("value-cell-blur"),t[1].classList.add("value-cell-middle"),t[1].childNodes[0].classList.remove("value-blur"),t[1].childNodes[0].classList.add("option-value"))}function generateResult(){for(var i,e,n,r=!1,s=scoreHistory.length,o=0;o<s;o++)if(JSON.parse(scoreHistory[o].status))r=!0;else{r=!1;break}var t=getBoxInfo("997").boxType,u=document.getElementById("boxInner997"),f=document.getElementById("scoreBox"),n=document.getElementById("scoreSum").parentNode;r?(i=getInference(r,t),f.classList.remove("score-result-outer"),f.classList.add("score-result-outer1"),u.classList.remove("score-result-inner"),u.classList.add("score-result-inner1"),n.classList.remove("value-cell-blur"),n.classList.add("value-cell-blur1"),t===ResultBoxTypes.RESULT_SCORE_BOX?(document.getElementById("mainDiv").appendChild(getResultBox()),$("#resultBox").slideDown(),e=document.getElementById("resultText"),e.innerHTML=i[0].inferenceText,n=document.getElementById("scoreSum"),n.innerHTML=i[0].scoreSum):t===ResultBoxTypes.RESULT_BOX?(document.getElementById("mainDiv").appendChild(getResultBox()),$("#resultBox").slideDown(),e=document.getElementById("resultText"),e.innerHTML=i[0].inferenceText):t===ResultBoxTypes.SCORE_BOX&&(n=document.getElementById("scoreSum"),n.innerHTML=i[0].scoreSum)):(f.classList.remove("score-result-outer1"),f.classList.add("score-result-outer"),u.classList.remove("score-result-inner1"),u.classList.add("score-result-inner"),n.classList.remove("value-cell-blur1"),n.classList.add("value-cell-blur"),t===ResultBoxTypes.RESULT_SCORE_BOX?(getMainDiv().lastElementChild.id==="resultBox"&&getMainDiv().removeChild(getMainDiv().lastChild),document.getElementById("scoreSum").innerHTML=""):t===ResultBoxTypes.RESULT_BOX?getMainDiv().lastElementChild.id==="resultBox"&&getMainDiv().removeChild(getMainDiv().lastChild):t===ResultBoxTypes.SCORE_BOX&&(document.getElementById("scoreSum").innerHTML=""))}function getResultBox(){var n=document.createElement("div"),t,i;return n.setAttribute("class","activity-result-box-outer"),n.setAttribute("id","resultBox"),n.style.display="none",t=document.createElement("div"),t.setAttribute("class","activity-result-box-inner"),i=document.createElement("div"),i.setAttribute("class","inference-text"),i.setAttribute("id","resultText"),t.appendChild(i),n.appendChild(t),n}function getInference(n,t){var u=[],i,f,r;if(n){for(i=0,f=scoreHistory.length,r=0;r<f;r++){var e=Number(scoreHistory[r].rowIndex),o=getBoxInfo(e.toString()),s=Number(scoreHistory[r].cellIndex),h=Number(o.options[s].value);i=i+h}t===ResultBoxTypes.RESULT_SCORE_BOX?u.push({inferenceText:analyzeInference(i),scoreSum:i}):t===ResultBoxTypes.RESULT_BOX?u.push({inferenceText:analyzeInference(i)}):t===ResultBoxTypes.SCORE_BOX&&u.push({scoreSum:i})}return u}function analyzeInference(n){for(var r="",i=getBoxInfo("999"),u=i.result.length,t=0;t<u;t++)if(eval(n+i.result[t].operator+i.result[t].value)){r=i.result[t].inference;break}return r}function getRowId(n,t){return"box".concat(n).concat("_row").concat(t+1)}function expandRow(n,t,i){i===0?(t.classList.add("score-block-top-inner"),n.classList.remove("score-block-select-top"),n.classList.add("score-block-top-outer")):(t.classList.add("score-block-middle-inner"),n.classList.remove("score-block-select-middle"),n.classList.add("score-block-middle-outer"))}function collapseRow(n,t,i){var r=!1,u=setInterval(function(){r?(clearInterval(u),r=!1):(t.removeAttribute("class"),n.classList[0]==="score-block-top-outer"?(n.classList.remove("score-block-top-outer"),n.classList.add("score-block-select-top")):(n.classList.remove("score-block-middle-outer"),n.classList.add("score-block-select-middle")),i[0].classList.remove("text-cell-middle"),i[0].classList.add("text-cell-select"),i[1].classList.remove("value-cell-middle"),i[1].classList.add("value-cell-select"),r=!0)},400)}function ScoreTable(n){var t={};return t.clickedRow=n.closest("tr").index()-1,t.tableNodes=n[0].parentNode.childNodes,t.tableNodeId=n[0].parentNode.id,t.boxId=n[0].parentNode.parentNode.parentNode.id,t}function getAllScoreBlocks(){var n=document.getElementById("mainDiv");return n.childNodes}function getScoreLength(){return getAllScoreBlocks().length}function getTableBlockIndex(n){for(var i=[],r=getAllScoreBlocks(),t=0;t<r.length;t++)i.push(r[t].id);return i.indexOf(n)}function sendHistory(){Android.saveData(JSON.stringify(scoreHistory))}function saveHistory(){return JSON.stringify(scoreHistory)}function addFooter(){var i=document.getElementsByTagName("body")[0],t=document.createElement("div"),n,r;t.setAttribute("class",StyleClass.FOOTER);t.setAttribute("id","998");n=getBoxInfo("998");r=document.createElement("table");typeof n.extraButtons!="undefined"&&n.extraButtons.length>0&&i.appendChild(addExtraButtons(n))}function addExtraButtons(n){var f=n.extraButtons,i=document.createElement("div"),r,t,u;for(i.setAttribute("class","footer-div"),i.setAttribute("id","998"),r=getColspanFactor(f),t=document.createElement("table"),t.setAttribute("class","footer-button-table"),u=0;u<f.length;u++)t.appendChild(getExtraButtonRow(f[u],r));return n.hasAbbreviation&&t.appendChild(getAbbreviationTextRow(n,r)),n.hasFootnote&&t.appendChild(getReferenceTextRow(n,r)),i.appendChild(t),i}function getExtraButtonRow(n,t){for(var i,f=document.createElement("tr"),r=n.buttonRow,e=makeSizer(r.length),o=t/r.length,u=0;u<r.length;u++)i=document.createElement("td"),i.setAttribute("class","footer-button"),i.setAttribute("colspan",o.toString()),i.style.width=e,i.appendChild(getFooterButton(r[u])),f.appendChild(i);return f}function getFooterButton(n){var t=document.createElement("button"),u,i,r;return t.setAttribute("class","mfooter-button"),t.setAttribute("id",n.buttonId),u=Object.keys(n),u.indexOf("image")===0?(i=document.createElement("img"),i.setAttribute("id","algoPdf"),i.setAttribute("src","algo_pdf_white.png"),i.setAttribute("alt","Static version"),t.appendChild(i),r=document.createElement("a"),r.setAttribute("href","flipView"),r.appendChild(t),r):(t.innerHTML=document.createTextNode(n.text).data,t)}function getReferenceTextRow(n,t){var f=document.createElement("tr"),e=document.createTextNode(n.referenceText),u=document.createElement("p"),i,r;return u.setAttribute("class",StyleClass.TEXT_LEFT),u.innerHTML=e.data,i=document.createElement("div"),i.setAttribute("class",StyleClass.REFERENCE_BOX),i.appendChild(u),r=document.createElement("td"),r.setAttribute("colspan",(t/1).toString()),r.appendChild(i),f.appendChild(r),f}function getAbbreviationTextRow(n,t){var f=document.createElement("tr"),e=document.createTextNode(n.abbreviationText),u=document.createElement("p"),i,r;return u.setAttribute("class",StyleClass.TEXT_LEFT),u.innerHTML=e.data,i=document.createElement("div"),i.setAttribute("class",StyleClass.REFERENCE_BOX),i.appendChild(u),r=document.createElement("td"),r.setAttribute("colspan",(t/1).toString()),r.appendChild(i),f.appendChild(r),f}function getColspanFactor(n){for(var t=1,i=0;i<n.length;i++)t=t*n[i].buttonRow.length;return t}function getBoxInfo(n){for(var i="",t=0;t<scoreData.length;t++)if(scoreData[t].boxId===n){i=scoreData[t];break}return i}function makeSizer(n){return 100/n+"%"}function getMainDiv(){return document.getElementById("mainDiv")}function loadHistory(n){var i,o,u,f,t;for(console.log(JSON.stringify(n)),i=0;i<n.length;i++){var t=n[i],s=document.getElementById(i+1),r=document.getElementById(i+1).childNodes,h=document.getElementById(s.parentNode.id),e=document.getElementById(s.parentNode.parentNode.id);if(JSON.parse(t.status)===!0){for(o="box".concat(i+1).concat("_row").concat(Number(t.cellIndex)+2),u=0;u<r.length;u++)u>0&&r[u].id!==o&&(document.getElementById(r[u].id).style.display="none");collapseRow(e,h,document.getElementById(o).childNodes)}else if(JSON.parse(t.isExpanded)===!1)for(e.classList.remove("score-block-middle-outer"),e.classList.add("score-block-blur"),h.classList.remove("score-block-middle-inner"),f=0;f<r.length;f++)f===0?(t=r[f].childNodes,t[0].classList.remove("text-cell-top"),t[0].classList.add("text-cell-blur"),t[0].childNodes[0].classList.remove("question-text"),t[0].childNodes[0].classList.add("text-blur"),t[1].classList.remove("value-cell-top"),t[1].classList.add("value-cell-blur"),t[1].childNodes[0].classList.remove("max-value"),t[1].childNodes[0].classList.add("value-blur")):document.getElementById(r[f].id).style.display="none"}generateResult()}function addStaticAssets(){var t=document.getElementById("staticMainDiv"),n=getBoxInfo("998");n.staticImageName!==""&&typeof n.staticImageName!="undefined"&&t.appendChild(getStaticImage(n.staticImageName));t.appendChild(addStaticFooter(n))}function addStaticFooter(n){var t=document.createElement("table");return t.appendChild(getStaticFootNoteButtonRow(n)),n.hasAbbreviation&&t.appendChild(getStaticAbbreviationTextRow(n)),n.hasFootnote&&t.appendChild(getStaticReferenceTextRow(n)),t}function getStaticImage(){var n=document.createElement("img");return n.setAttribute("id","staticImage"),window.setTimeout(n.setAttribute("src",loadStaticImage()),500),n.style.width="100%",n}function getStaticFootNoteButtonRow(){var n=document.createElement("tr"),t=document.createElement("td");return t.appendChild(addStaticFlipPdfButton()),n.appendChild(t),n}function getStaticReferenceTextRow(n){var u=document.createElement("tr"),f=document.createTextNode(n.referenceText),i=document.createElement("p"),t,r;return i.setAttribute("class",StyleClass.TEXT_LEFT),i.innerHTML=f.data,t=document.createElement("div"),t.setAttribute("class",StyleClass.STATIC_REFERENCE_BOX),t.appendChild(i),r=document.createElement("td"),r.appendChild(t),u.appendChild(r),u}function getStaticAbbreviationTextRow(n){var u=document.createElement("tr"),f=document.createTextNode(n.abbreviationText),i=document.createElement("p"),t,r;return i.setAttribute("class",StyleClass.TEXT_LEFT),i.innerHTML=f.data,t=document.createElement("div"),t.setAttribute("class",StyleClass.STATIC_REFERENCE_BOX),t.appendChild(i),r=document.createElement("td"),r.appendChild(t),u.appendChild(r),u}function addStaticFlipPdfButton(){var i=document.createElement("img"),n,t;return i.setAttribute("src","algo.png"),i.setAttribute("class",StyleClass.PDF_IMAGE),n=document.createElement("button"),n.setAttribute("id","pdf_button"),n.setAttribute("class",StyleClass.FLIP_PDF_BUTTON),t=document.createElement("a"),t.setAttribute("href","flipView"),n.appendChild(i),t.appendChild(n),t}function loadStaticImage(){var t=getBoxInfo("998"),n=t.staticImageName+"_portrait.png";return window.matchMedia("(orientation: portrait)").matches?n=t.staticImageName+"_portrait.png":window.matchMedia("(orientation: landscape)").matches&&(n=t.staticImageName+"_landscape.png"),console.log(n),n}var scoreHistory,currentPosition;$(document).ready(function(){var n=!1;$("body").on("click","tr",function(){var n=$(this).attr("id");n!=="resetButton"&&typeof n!="undefined"&&showNextScoreBlock($(this))});$("body").on("click","button",function(){switch($(this).attr("id")){case"refButton":n?($("#refButton").removeClass("footer-button-click").addClass("mfooter-button"),$(".reference-box").slideUpBox()):($("#refButton").removeClass("mfooter-button").addClass("footer-button-click"),$(".reference-box").slideDownBox(Scroll.LENGTH_LONG));n=!n;break;case"resetButton":n=!n;for(var t=document.getElementById("mainDiv");t.firstChild;)t.removeChild(t.firstChild);document.getElementsByTagName("body")[0].removeChild(document.getElementById("998"));document.getElementById("headerDiv")!==null&&document.getElementsByTagName("body")[0].removeChild(document.getElementById("headerDiv"));loadDataFile("")}})});scoreHistory=[];const ScoreStyleClass={QUESTION_TEXT:"question-text",MAX_VALUE:"max-value",OPTION_TEXT:"option-text",OPTION_VALUE:"option-value",TEXT_BLUR:"text-blur",VALUE_BLUR:"value-blur",SCORE_BLOCK_TOP_OUTER:"score-block-top-outer",SCORE_BLOCK_MIDDLE_OUTER:"score-block-middle-outer",SCORE_BLOCK_TOP_INNER:"score-block-top-inner",SCORE_BLOCK_MIDDLE_INNER:"score-block-middle-inner",SCORE_BLOCK_BLUR:"score-block-blur",SCORE_RESULT_OUTER:"score-result-outer",SCORE_RESULT_INNER:"score-result-inner"},Mode={FOCUS:"focus",BLUR:"blur"},Dimensions={INNER:"-inner",OUTER:"-outer"},Scroll={LENGTH_SHORT:100,LENGTH_LONG:700},BoxTypes={FOOTER:"footer"},FooterButtons={PDF_BUTTON:"pdfButton",RESET_BUTTON:"resetButton",REF_BUTTON:"refButton",MORE_INFO_BUTTON:"moreInfoButton"},StyleClass={ABB_BUTTON:"abb-button",PDF_IMAGE:"pdf-image",REFERENCE_BOX:"reference-box",STATIC_REFERENCE_BOX:"static-reference-box",FOOTER:"footer",FLIP_PDF_BUTTON:"flip-pdf-button",EXCEPTION_MESSAGE:"exception-message",RESET_BUTTON:"reset-button",TEXT_LEFT:"text-left"},ResultBoxTypes={RESULT_BOX:"result-box",SCORE_BOX:"score-box",RESULT_SCORE_BOX:"result-score-box",NONE:"none",FOOTER:"footer"};window.addEventListener("orientationchange",function(){document.title.toLowerCase()!=="score"&&window.setTimeout(document.getElementById("staticImage").setAttribute("src",loadStaticImage()),500)},!1),function(n){n.fn.change=function(t){return t===0?this.each(function(){n(this).css({background:"#cc3d44",color:"white",boxShadow:"0 0 0 0 #ffffff"})}):t===1?this.each(function(){n(this).css({background:"#ffffff",color:"#999999",boxShadow:"0 0 0 0 #ffffff"})}):t===2?this.each(function(){n(this).css({background:"#ffffff",color:"#999999",boxShadow:"0 0 0 0 #ffffff"})}):t===3?this.each(function(){n(this).css({background:"#ffffff",color:"#999999",boxShadow:"0 0 0 0 #ffffff"})}):void 0};n.fn.scroll=function(t){return this.each(function(){n("html, body").animate({scrollTop:n(this).offset().top},t)})};n.fn.slideUpBox=function(){return this.each(function(){n(this).slideUp("700",function(){n(this).scroll()})})};n.fn.slideDownBox=function(t){return this.each(function(){n(this).slideDown("700",function(){n(this).scroll(t)})})}}(jQuery);